---
layout: post
title: Mac 下使用 adb 命令分析内存使用
tags:
- Android 内存优化
categories: Android
description: 使用 adb 命令可以很直接的观察你的应用。
---
 使用 adb 观察你的应用内存使用量。可以明显的观测 Activity 对象是否被回收

通过adb命令能获得手机的很多内容
本文介绍的是 adb shell dumpsys meminfo "packageName" 命令

##首先来个案例先
```
新建一个工程，此处我的包名为 com.xiao.test,有一个 MainActivity 和一个 SecondActivity，其中 MainActivity 有一个按钮只是用来跳转到 SecondActivity。
```
**启动程序，在终端中输入**
```
adb shell dumpsys meminfo com.test.xiao
```
![](http://img.blog.csdn.net/20160908144356235)
图中红框上一部分是内存的具体使用情况，红框内显示出最容易泄漏的对象 Activity。现在我们只启动了一个 MainActivity，图中也正是一个 Activity 对象，一切正常。
接着，点击 MainActivity 中的一个按钮启动 SecondActivity，**此时 SecondActivity 没有做任何事**，继续在终端中输入
```
adb shell dumpsys meminfo com.test.xiao
```
![这里写图片描述](http://img.blog.csdn.net/20160908145509395)

OK，不错，一切正常。
接着按 back 键结束 SecondActivity，**严谨一点此时应该手动GC的，但是现在只是很简单的功能，系统 GC 也来得及**。输入 adb命令，此时的 Activitys 数量又变为 1，这里就不贴图了。

接下来在 SecondActivity 的 onCreate() 加一段典型会内存泄漏的代码

``` java
new Handler().postDelayed(new Runnable() {
@Override
public void run() {
// 设置一个20秒后执行的空任务
}
}, 20000);
```
退出应用重新来一遍

启动 MainActivity，再启动 SecondActivity，然后立即 back 返回结束掉 SecondActivity，此时 Handler 还有任务未结束，所以肯定是内存泄漏了，这个 Activity 对象就消耗不了。
再来一遍命令
```
adb shell dumpsys meminfo com.test.xiao
```
![](http://img.blog.csdn.net/20160908152623599)
果然没回收 Activity 对象。















